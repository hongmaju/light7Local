<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/light7.css">
    <!--     <link rel="stylesheet" type="text/css" href="./css/base.css"> -->
    <link rel="stylesheet" type="text/css" href="./css/login.css">
    <script type="text/javascript" src="./js/jquery.js"></script>
</head>

<body>
    <header class="bar bar-nav">
        <h1 class="title">登录收银宝账号</h1>
    </header>
    <div class="content">
        <header>
            <div id="header">
                <a class="logo" title="美萍收银宝">
                    <img src="./img/mplogin6.png">
                </a>
            </div>
        </header>
        <div class="list-block">
            <ul>
                <!-- Text inputs -->
                <li>
                    <div class="item-content">
                        <div class="item-media"><i class="icon icon-form-name"></i></div>
                        <div class="item-inner">
                            <div class="item-title label">用户名</div>
                            <div class="item-input">
                                <input type="text" placeholder="输入用户名">
                            </div>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="item-content">
                        <div class="item-media"><i class="icon icon-form-password"></i></div>
                        <div class="item-inner">
                            <div class="item-title label">密码</div>
                            <div class="item-input">
                                <input type="password" placeholder="输入密码" class="">
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="content-block">
            <p><a href="#" class="button button-big">登录</a></p>
        </div>
        <div class="content-block">
            <p><a href="#" class="open-about">设置手势密码 </a></p>
        </div>
        <div class="bar bar-footer">
            <a class="icon icon-edit pull-right"></a>
            <a class="icon icon-settings pull-left"></a>
        </div>
    </div>
    <!-- 关于弹出窗 Popup -->
    <div class="popup popup-about">
        <div class="content-block">
           
            <p>
                <div class="canvasPass">
                    <canvas id="myCanvas"></canvas>
                </div>
            </p>
            <!--  <p>设置手势密码</p> -->
            <p><a href="#" class="close-popup">关闭弹出窗</a></p>
        </div>
    </div>
    <script>
    //关闭light7自带路由(需在调用light7.min.js之前关闭)，使用vue-router

    $.config = {
        // autoInit: true //no recommend
        router: false
    }
    $(document).on('click', '.open-about', function() {
        $.popup('.popup-about');
    });
    // 手势密码
    var R = 26,
        CW = 400,
        CH = 320,
        OffsetX = 30,
        OffsetY = 30;

    function CaculateNinePointLotion(diffX, diffY) {
        var Re = [];
        for (var row = 0; row < 3; row++) {
            for (var col = 0; col < 3; col++) {
                var Point = {
                    X: (OffsetX + col * diffX + (col * 2 + 1) * R),
                    Y: (OffsetY + row * diffY + (row * 2 + 1) * R)
                };
                Re.push(Point);
            }
        }
        return Re;
    }
    var PointLocationArr = [];
    window.onload = function() {
        var c = document.getElementById("myCanvas");
        CW = document.body.offsetWidth;
        c.width = CW;
        c.height = CH;
        var cxt = c.getContext("2d");
        //两个圆之间的外距离 就是说两个圆心的距离去除两个半径
        var X = (CW - 2 * OffsetX - R * 2 * 3) / 2;
        var Y = (CH - 2 * OffsetY - R * 2 * 3) / 2;
        PointLocationArr = CaculateNinePointLotion(X, Y);
        InitEvent(c, cxt);
        //CW=2*offsetX+R*2*3+2*X
        Draw(cxt, PointLocationArr, [], null);
    }

    function Draw(cxt, _PointLocationArr, _LinePointArr, touchPoint) {
        if (_LinePointArr.length > 0) {
            cxt.beginPath();
            for (var i = 0; i < _LinePointArr.length; i++) {
                var pointIndex = _LinePointArr[i];
                cxt.lineTo(_PointLocationArr[pointIndex].X, _PointLocationArr[pointIndex].Y);
            }
            cxt.lineWidth = 10;
            cxt.strokeStyle = "#627eed";
            cxt.stroke();
            cxt.closePath();
            if (touchPoint != null) {
                var lastPointIndex = _LinePointArr[_LinePointArr.length - 1];
                var lastPoint = _PointLocationArr[lastPointIndex];
                cxt.beginPath();
                cxt.moveTo(lastPoint.X, lastPoint.Y);
                cxt.lineTo(touchPoint.X, touchPoint.Y);
                cxt.stroke();
                cxt.closePath();
            }
        }
        for (var i = 0; i < _PointLocationArr.length; i++) {
            var Point = _PointLocationArr[i];
            cxt.fillStyle = "#627eed";
            cxt.beginPath();
            cxt.arc(Point.X, Point.Y, R, 0, Math.PI * 2, true);
            cxt.closePath();
            cxt.fill();
            cxt.fillStyle = "#ffffff";
            cxt.beginPath();
            cxt.arc(Point.X, Point.Y, R - 3, 0, Math.PI * 2, true);
            cxt.closePath();
            cxt.fill();
            if (_LinePointArr.indexOf(i) >= 0) {
                cxt.fillStyle = "#627eed";
                cxt.beginPath();
                cxt.arc(Point.X, Point.Y, R - 16, 0, Math.PI * 2, true);
                cxt.closePath();
                cxt.fill();
            }

        }
    }

    function IsPointSelect(touches, LinePoint) {
        for (var i = 0; i < PointLocationArr.length; i++) {
            var currentPoint = PointLocationArr[i];
            var xdiff = Math.abs(currentPoint.X - touches.pageX);
            var ydiff = Math.abs(currentPoint.Y - touches.pageY);
            var dir = Math.pow((xdiff * xdiff + ydiff * ydiff), 0.5);
            if (dir < R) {
                if (LinePoint.indexOf(i) < 0) {
                    LinePoint.push(i);
                }
                break;
            }
        }
    }

    function InitEvent(canvasContainer, cxt) {
        var LinePoint = [];
        canvasContainer.addEventListener("touchstart", function(e) {
            IsPointSelect(e.touches[0], LinePoint);
        }, false);
        canvasContainer.addEventListener("touchmove", function(e) {
            e.preventDefault();
            var touches = e.touches[0];
            IsPointSelect(touches, LinePoint);
            cxt.clearRect(0, 0, CW, CH);
            Draw(cxt, PointLocationArr, LinePoint, {
                X: touches.pageX,
                Y: touches.pageY
            });
        }, false);
        canvasContainer.addEventListener("touchend", function(e) {
            cxt.clearRect(0, 0, CW, CH);
            Draw(cxt, PointLocationArr, LinePoint, null);
            alert("密码结果是：" + LinePoint.join("->"));
            LinePoint = [];
        }, false);
    }
    </script>
    <script type="text/javascript" src="./js/light7.js"></script>
</body>

</html>
